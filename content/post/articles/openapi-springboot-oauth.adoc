---
title: "OpenApi generator client auth token management"
date: 2020-02-05T21:24:11+01:00
draft: true
tags: ["OpenAPI Generator", "SpringBoot", "Oauth2"]
---

In my team, we try to use a contract-first approach for our REST APIs.
With multiple microservices, we need to pass user token when we call another service.

In this article, I will show how to easily pass this token with a generated RestTemplate client and Springboot.
<!--more-->

== SetUp

You can download the base project on https://github.com/Zomzog/openapi-spring-client-token[github].
It contains two servers.

=== The API

For this article I will use a simple CRUD API for ponies.
{{< accordion title="api.yml" >}}
{{< highlight yaml "linenos=table" >}}
---
openapi: "3.0.1"
info:
  title: "My Little Pony"
  description: "Friendship is magic"
  contact: {}
  version: "1.0.0"
paths:
  /ponies:
    summary: "Everything for ponies"
    get:
      summary: "List"
      operationId: "list"
      parameters:
        - name: "name"
          in: "query"
          required: false
          schema:
            type: "string"
          example: "Rainbow Dash"
      responses:
        "200":
          description: "Status 200"
          content:
            application/json:
              schema:
                type: "array"
                items:
                  $ref: "#/components/schemas/Pony"
        "400":
          description: "Status 400"
    post:
      summary: "Create"
      operationId: "create"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Pony"
      responses:
        "201":
          description: "Status 201"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Pony"
        "400":
          description: "Status 400"
  /ponies/{ponyId}:
    get:
      summary: "Get one"
      operationId: "getOne"
      responses:
        "200":
          description: "Status 200"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Pony"
    put:
      summary: "Update"
      operationId: "update"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Pony"
      responses:
        "200":
          description: "Status 200"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Pony"
    delete:
      summary: "Delete one"
      operationId: "deleteOne"
      responses:
        "200":
          description: "Status 200"
    parameters:
      - name: "ponyId"
        in: "path"
        required: true
        schema:
          type: "string"
components:
  schemas:
    Pony:
      type: "object"
      required:
        - "Color"
        - "Name"
      properties:
        Id:
          type: "string"
        Name:
          type: "string"
          minLength: 1
          maxLength: 100
          example: "Big McIntosh"
        Color:
          $ref: "#/components/schemas/Color"
        CreatedAt:
          type: "integer"
          format: "int64"
          description: "Timestamp"
    Color:
      type: "string"
      enum:
        - "RED"
        - "RAINBOW"
        - "BLUE"
      example: "RED"

{{< / highlight >}}
{{< / accordion >}}

=== Front

It is the Authorization Server.
You can obtain a JWT token with this call :
{{< accordion title="curl login" >}}
{{< highlight java "linenos=table" >}}
curl --location --request POST 'localhost:8080/oauth/token' \
    --header 'Content-Type: application/x-www-form-urlencoded' \
    --header 'Authorization: Basic Y2xpZW50SWQ6Y2xpZW50U2VjcmV0' \
    --data-urlencode 'username=user1' \
    --data-urlencode 'password=password' \
    --data-urlencode 'grant_type=password'
{{< / highlight >}}
{{< / accordion >}}

This server will also contains the generated client.

=== Back

This one contains the generated server side.

== Links 

https://github.com/Zomzog/openapi-spring-client-token[Demo project]

https://github.com/OpenAPITools/openapi-generator[OpenAPI Generator]